# 2025 스마트 농업 AI 경진대회 사전테스트

### **2025-07-30 ~ 2025.07.31**
### [Competition Link](https://agrichallenge.ai)
-  2025 년 스마트농업 AI 경진대회 예선 진출팀 선정을 위해 프로그래밍 역량 및 농업 도메인에 대한
이해도 평가를 목적으로 문제 출제

- 평가 산식: RMSE (Root Mean Squared Error, 평균 제곱근 오차)  
R2 (R-squared, 결정 계수)


- 19th pre-test Pass
 
- 주최: 농림축산식품부  
주관: 한국농업기술진흥원, 농협중앙회
---

### **주요 특징**

- **계층적 앙상블 모델링**: **전체 학습 모델**, **건물 유형별모델**, **개별 건물 모델**을 각각 학습하여 계층형으로 앙상블 했습니다.
- **상세한 피처 엔지니어링**: 시계열 특징을 가진 변수, 공휴일, 기상 지수(CDH, THI, WCT) 등 도메인 특성을 반영한 다양한 파생 변수를 생성하여 모델의 예측력을 높였습니다.
- **모델 앙상블**: **XGBoost**와 **LightGBM**을 각각 계층적 모델링에 적용한 후, 두 모델의 예측 결과를 **가중 평균 앙상블**하여 LB점수가 조금 떨어져도 최종 예측의 일반화와 과적합을 방지하는 선택을 하였습니다..
- **이상치 처리**: 각 건물의 데이터 분포를 분석하여 발견된 이상치를 정교하게 제거하여 모델 학습의 견고함을 높였습니다.

---

### **개발 환경**

- **운영체제**: macos 26.0
- **언어**: Python 3.11

---

### **프로젝트 구조**

```
2025_Smart_Agriculture_AI_Competition/
├── data/               
│   ├── x_train.csv
│   ├── x_test.csv
│   ├── y_train.csv
│   └── 2025 스마트농업 AI 경진대회_사전테스트_문제 설명서_최종.pdf
├── notebooks/           
│   ├── inference.ipynb
│   ├── train-ml.ipynb
│   └──train-rnncnn.ipynb
├── outputs/
│   ├── models/
│   └──submission.csv
├── .gitignore        
├── README.md           
└── requirements.txt    
```

---

### **모델링 과정**

모델의 성능을 극대화하고 과적합(overfitting)을 방지하기 위해 다음과 같은 전략적 접근을 일관되게 적용합니다. 

***

### 1. 교차 검증 기반의 모델링 및 앙상블 적용
전체 모델링 파이프라인에 대해 동일한 **교차 검증(cross-validation)** 방식을 적용하였으며, 각 모델별 예측 결과를 산술 평균 방식으로 앙상블하여 안정성과 예측력을 동시에 확보했습니다. 

### 2. 전처리 및 특성 선택의 다양성 확보
**앙상블 효과를 극대화**하기 위해 각 개별 모델에 대해 서로 다른 데이터 전처리 및 특성 선택 방법을 독립적으로 적용했습니다.  이를 통해 서로 다른 관점에서의 학습 모델을 생성하고, 예측의 다양성을 확보했습니다. 

### 3. Out-Of-Fold 기반 다중 모델 학습 구조
모든 개별 모델은 **OOF(Out-Of-Fold)** 방식으로 학습하였으며, 각 모델은 교차 검증 fold 수에 따라 총 5개의 하위 모델(sub-model)을 저장했습니다. 
이는 최종 예측 시 모델 불확실성 감소 및 성능 안정화에 기여하도록 설계된 것입니다.

***

## RNN+CNN 기반 모델

#### 데이터 전처리 및 특성 선택 방법
* 개별 샘플의 시계열적 패턴을 반영하기 위해 입력 데이터를 `(Batch, Sequence, Features)` 형태의 **3차원 텐서**로 변환하여 시간 흐름에 따른 특성 변화를 모델이 학습할 수 있도록 구성했습니다. 
* 각 샘플 단위로 집계된 정적 특성(예: 평균, 총합 등)은 `(Batch, Features)` 형태의 **2차원 텐서**로 구성하여 모델에 함께 입력되도록 설계했습니다.

#### 모델 아키텍처 및 주요 하이퍼파라미터
* 모델은 입력 데이터 특성에 따라 두 가지 주요 경로로 구성되며, 이후 통합되어 최종 예측을 수행합니다.
* 3차원 시계열 데이터는 먼저 **LSTM 레이어**를 통과하여 시점 간의 연속적 관계를 학습한 후, 이어지는 **CNN 레이어**를 통해 시계열 히든 표현 내에서 지역적 시공간 특성을 추출합니다.
* 2차원 형태의 집계된 정적 특성은 잔차 연결 기반(**Residual Block** 형태)의 **Fully Connected Layer**를 통해 처리됩니다.

***

## ML 기반 모델

#### 데이터 전처리 및 특성 선택 방법
* 기본적인 통계량과 비율 변수들을 생성하고 시계열 기반의 기울기, 이동평균, 분산, 누적 평균 등을 파생변수로 사용했습니다.  
* 풍향은 **sin/cos 변환**을 통해 주기성을 반영했고, 온도 및 습도의 경우 실내외 차이(mean, std 등)를 계산했습니다.  또한 강우 센서는 총량, 변화량 등 통계값을 파생변수로 생성했습니다.  
* 수백 가지의 변수 생성으로 인한 노이즈를 방지하기 위해, **Feature Selection**으로 중요도 기준 상위 20개의 컬럼을 최종 모델 학습 변수로 사용했습니다.  

#### 모델 선정 및 학습 전략
* **부스팅 기반 모델**(XGB, LGBM, Catboost)과 **배깅 기반 모델**(RandomForest) 네 가지를 앙상블을 위해 학습시켰습니다.  부스팅 계열과 트리 계열 모델이 상호 보완하며 일반화 성능을 높여줄 것으로 판단했습니다.  
* **Optuna**를 이용하여 각 모델의 최적 하이퍼파라미터 값을 탐색했으며, RMSE 값을 기준으로 가장 낮은 점수가 나오는 하이퍼파라미터를 선정했습니다.



